let connectionService,queryservice,logger;_b41‍.x([["default",()=>_b41‍.o]]);_b41‍.w("./ConnectionService",[["default",["connectionService"],function(v){connectionService=v}]]);_b41‍.w("./QueryService",[["default",["queryservice"],function(v){queryservice=v}]]);_b41‍.w("./LoggerService",[["default",["logger"],function(v){logger=v}]]);



class ArticleService {
    async postArticle(name, price) {
        let connection;

        try {
            connection = await connectionService.pool.getConnectionAsync();
            const dbQuery = queryservice.queries.insertArticl;
            await connection.queryAsync(dbQuery, {
                name,
                price,
            });

            return {
                isSuccessfully: true
            };
        } catch (error) {
            
            const test = logger.info('Article service error');
            _b41‍.g.console.log(test);
            return error;
        } finally {
            if(connection) {
                connection.release();
            }    
        }
    }

    async putArticle(id, name, price) {
        let connection;
        let totalItemCount = 0;

        try {
            connection = await connectionService.pool.getConnectionAsync();
            connection.beginTransactionAsync();

            const countInvoiceItemsQuery = queryservice.queries.countInvoiceItemByArticleId;
            const dbQuery = queryservice.queries.updateArticle;

            const totalInvoiceItemResult = await connection.queryAsync(countInvoiceItemsQuery, {
                id,
            });

            totalItemCount = totalInvoiceItemResult[0].TotalInvoiceItems;

            if(totalItemCount >=1) {
                return {
                    warningMessage: `You cannot modify the item! The item is on the invoice item.`
                }
            }
            
            await connection.queryAsync(dbQuery, {
                id,
                name,
                price,
            });

            connection.commit();
            return {
                isSuccess: true,
            };
        } catch (error) {
            return error;
        } finally {
            if(connection){
                connection.release();
            }
        }
    }

    async deleteArticle(id) {
        let connection;
        try {
            connection = await connectionService.pool.getConnectionAsync();
            const dbQuery = queryservice.queries.deleteArticle;
            await connection.queryAsync(dbQuery, {
                id,
            });

            return {
                isSuccess: true
            };
        } catch (error) {
            return error;
        } finally {
            if(connection) {
                connection.release();
            }
        }
    }
}

_b41‍.d(new ArticleService());
